{% extends "base.html" %}


{% block content %}

<h1>Add Review</h1>

<div>
    <mapbox-search-box
        access-token="{{ mapbox_access_token }}"
        placeholder="Search for a restaurant..."
        proximity="0,0"
    >
    </mapbox-search-box>
</div>

<form method="post" action="{% url 'add_review' %}" enctype="multipart/form-data">
    {% csrf_token %}

    {{ form.as_p }}
    
    <input type="hidden" id="selected-place" name="selected_place">
    <button type="submit">Submit</button>
</form>

<script>
    document.getElementById('search-js').onload = function () {
            const searchBox = document.querySelector('mapbox-search-box');

            searchBox.options = {
                language: 'en',
            };

            searchBox.addEventListener('retrieve', (e) => {
                const feature = e.detail;
                console.log(feature);
                alert(JSON.stringify(feature, null, 2));

                const selectedPlace = {
                    place_id: feature.properties.mapbox_id,
                    name: feature.properties.name,
                    address: feature.properties.address,
                    city_name:feature.properties.context.place.name,
                    country: feature.properties.context.country.name,
                    latitude: feature.geometry.coordinates[1],
                    longitude: feature.geometry.coordinates[0],  
                };

                alert("place saved");

                document.getElementById('selected-place').value = JSON.stringify(selectedPlace);
            });
    };
</script>

{% endblock %}